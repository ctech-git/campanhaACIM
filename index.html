<!DOCTYPE html>
<html lang="en">

<head>
	<title>Saldão de Aniversário</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<meta content="Vem participar do Saldão de Aniversário de Marabá!" name="description" />
	<meta content="satisfacao, avaliacao, formularios" name="keywords" />

	<meta property="og:locale" content="pt_BR">

	<meta property="og:url" content="https://www.acimmaraba.com.br/campanhaACIM">
	<meta property="og:title" content="Vem participar do Saldão de Aniversário de Marabá!">
	<meta property="og:site_name" content="Sua plataforma de inscrição online!">
	<meta property="og:description"
		content="Com descontos atrativos, o consumidor compra mais e o volume de vendas movimenta a economia da cidade">

	<meta property="og:image" itemprop="image" content="https://acimmaraba.com.br/campanhaACIM/images/logo.png">
	<meta property="og:type" content="website">
	<meta property="og:image:type" content="image/jpeg">
	<meta property="og:image:width" content="300">

	<meta property="og:image:height" content="200">

	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.ico" />
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--===============================================================================================-->
</head>

<body style='background-color: #fff;'>


	<div class="limiter" id='parte_1' style='background-color: #fff;'>
		<div class="container">

			<div class='row' style="justify-content: center; margin-top:50px; margin-bottom:50px">

				<span class="">
					<img id='logo' src="images/logo.png" style='width: 200px;' alt="">
				</span>
			</div>

			<h3 style='margin:auto;text-align:center;margin-bottom:80px'>Venha participar do <strong>Maior Saldão de
					Aniversário de Marabá</strong>
			</h3>

			<div id='inputsTexto'>


				<div class='col-12 col-md-12 col-lg-12' style='margin-top: 4rem !important'>
					<label>Qual seu nome?</label><input value="Rodolfo A Geyer" class='form-control'
						placeholder='Digita seu nome aqui' id='nome' />
				</div>
				<div class='col-12 col-md-12 col-lg-12' style='margin-top: 2rem !important'>
					<label>Qual seu telefone?</label><input value='94991006004' class='form-control'
						placeholder='Digita seu telefone aqui' id='telefone' inputmode="numeric" />
				</div>
				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Qual sua empresa?</label><input class='form-control' value="ctech" id='empresa' inputmode="numeric"
						placeholder='Seu nome fantasia' />
				</div>

				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Qual seu CNPJ?</label><input class='form-control' value="32781035000100" id='cnpj' inputmode="numeric"
						placeholder='Ex: 00.000.000/0001-00' />
				</div>

				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Você é associado?</label>
					<select id='associado' class="form-control">
						<option selected value="Sim">Sim</option>
						<option value="Não">Não</option>
					</select>
				</div>

				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Quantos kits você deseja?</label><input value='2' class='form-control' onchange="contagemKits()"
						id='kits' inputmode="numeric" placeholder='Ex: 3' />
				</div>

				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<p>Atenção: você pode escolher <strong>5 camisas a cada kit</strong>. Por exemplo: se escolher dois kits,
						poderá escolher até
						10
						camisas.
						</br>
						</br>
						<strong>Cada camisa extra custará R$ 25,00.</strong>

					</p>
				</div>

				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important' id='valorTotal'>


				</div>

				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Quantas camisas PP?</label><input value="1" class='form-control' id='camisaPP'
						onchange="contagemKits()" inputmode="numeric" placeholder='Ex: 1' />
				</div>
				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Quantas camisas P?</label><input class='form-control' id='camisaP' onchange="contagemKits()"
						inputmode="numeric" placeholder='Ex: 2' />
				</div>
				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Quantas camisas M?</label><input class='form-control' id='camisaM' onchange="contagemKits()"
						inputmode="numeric" placeholder='Ex: 3' />
				</div>
				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Quantas camisas G?</label><input class='form-control' id='camisaG' onchange="contagemKits()"
						inputmode="numeric" placeholder='Ex: 4' />
				</div>
				<div class='col-12 col-md-12 col-lg-12 ' style='margin-top: 2rem !important'>
					<label>Quantas camisas GG?</label><input class='form-control' id='camisaGG' onchange="contagemKits()"
						inputmode="numeric" placeholder='Ex: 5' />
				</div>

			</div>

			<div class='col-12 col-md-12 col-lg-12 mt-5'>
				<button style='width:100%;height: 80px;border-color: #2c2d48; background-color: #2c2d48;'
					class='btn btn-success' onclick='enviar_resposta()'>Participar da campanha <i
						class='fa fa-check'></i></button>
			</div>

			<style>
				.btn-check {
					display: none;
				}
			</style>
			<ul class="login-more p-t-100">
			</ul>
		</div>
	</div>

	<style>
		#titulo_pergunta {
			-webkit-transition: opacity .5s ease-in-out;
			-moz-transition: opacity .5s ease-in-out;
			-ms-transition: opacity .5s ease-in-out;
			-o-transition: opacity .5s ease-in-out;
			transition: opacity .5s ease-in-out;
		}
	</style>

	<div class="limiter" id='parte_2' style='display:none'>
		<div class="container-login100">
			<div class="wrap-login100 p-t-25 p-b-20">
				<form id='form_parte2' class="login100-form" style="text-align:center">

					<span class="">
						<img id='logo' src="images/logo.png" style='width: 200px;' alt="">
					</span>

					</br>

					<span class="">
						<img id='qrCodeGif' src="images/loading.gif" style='width: 120px;' alt="">
					</span>

					<div class='row'>
						<div class='col-12 col-md-12 col-lg-12 mt-5' id='textoQrCode'>
							<h4>Estamos gerando o seu QR Code</h4>

						</div>
					</div>
					<!-- <span class="">
						<img src="images/success.svg" alt="AVATAR">
					</span> -->
				</form>
			</div>
		</div>
	</div>

	<div class='footer'></div>


	<div id="dropDownSelect1"></div>

	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<!--===============================================================================================-->
	<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<!--===============================================================================================-->
	<script src="js/main.js"></script>
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"
		integrity="sha512-pHVGpX7F/27yZ0ISY+VVjyULApbDlD0/X0rgGbTqCE7WFW5MezNTWG/dnhtbBuICzsd0WQPgpE4REBLv+UqChw=="
		crossorigin="anonymous"></script>

</body>

</html>

<script type="text/javascript" charset="utf-8">

	$("#dataNascimento").mask('99/99/9999');
	$("#telefone").mask('(99) 9 9999-9999');
	$("#cnpj").mask('00.000.000/0000-00');


	$("#form_parte1").submit(function (event) {
		event.preventDefault();
		$('#parte_1').hide(1000);
		$('#parte_2').show(2000);
	});

	var i = 0;

	function formatar_para_real(resultado) {
		return parseFloat(resultado).toLocaleString('pt-BR', { minimumFractionDigits: 2, style: 'currency', currency: 'BRL' })
	}

	function contagemKits() {

		var associado = $('#associado').val();
		var kits = $('#kits').val();
		var camisaPP = $('#camisaPP').val() ? $('#camisaPP').val() : 0;
		var camisaP = $('#camisaP').val() ? $('#camisaP').val() : 0;
		var camisaM = $('#camisaM').val() ? $('#camisaM').val() : 0;
		var camisaG = $('#camisaG').val() ? $('#camisaG').val() : 0;
		var camisaGG = $('#camisaGG').val() ? $('#camisaGG').val() : 0;

		var quantidadeMaxKit = kits * 5;

		var soma = Number(camisaPP) + Number(camisaP) + Number(camisaM) + Number(camisaG) + Number(camisaGG);
		var resultado = 0;
		if (soma > quantidadeMaxKit) {
			var resultado = soma - quantidadeMaxKit;
			resultado = resultado * 25;
		}

		var valorTotal = 0;
		if (associado == 'Sim') {
			valorTotal = kits * 149.99;
		} else {
			valorTotal = kits * 199.99;
		}
		valorTotal = valorTotal + resultado;
		valorTaxa = valorTotal * 0.05;

		valorTotal = formatar_para_real(valorTotal);

		valorTaxa = formatar_para_real(valorTaxa);

		$('#valorTotal').html(`<h3>Valor kit: ${valorTotal} </h3><p>+Taxa de pagamento online: ${valorTaxa}</p>`);

	}

	function returnValorTotal() {

		var associado = $('#associado').val();
		var kits = $('#kits').val();
		var camisaPP = $('#camisaPP').val() ? $('#camisaPP').val() : 0;
		var camisaP = $('#camisaP').val() ? $('#camisaP').val() : 0;
		var camisaM = $('#camisaM').val() ? $('#camisaM').val() : 0;
		var camisaG = $('#camisaG').val() ? $('#camisaG').val() : 0;
		var camisaGG = $('#camisaGG').val() ? $('#camisaGG').val() : 0;

		var quantidadeMaxKit = kits * 5;

		var soma = Number(camisaPP) + Number(camisaP) + Number(camisaM) + Number(camisaG) + Number(camisaGG);
		var resultado = 0;
		if (soma > quantidadeMaxKit) {
			var resultado = soma - quantidadeMaxKit;
			resultado = resultado * 25;
		}

		var valorTotal = 0;
		if (associado == 'Sim') {
			valorTotal = kits * 149.99;
		} else {
			valorTotal = kits * 199.99;
		}
		valorTotal = valorTotal + resultado;
		return valorTotal;

	}


	function returnItems(valorTotal) {

		valorTotal = valorTotal * 1.05;

		let items = [{
			'amount': Math.round(valorTotal * 100),
			'description': "Inscrição no Saldão de Aniversário",
			'quantity': 1,
			'code': 1,
		}]
		return items;
	}

	function returnCustomer() {

		var telefone = $('#telefone').val();
		telefone = telefone.replace('(', '');
		telefone = telefone.replace(')', '');
		telefone = telefone.replace(' ', '');
		telefone = telefone.replace(' ', '');
		telefone = telefone.replace('-', '');

		let customer = {
			"name": $('#nome').val(),
			"email": 'acim@acimmaraba.com.br',
			"code": 1,
			"document": '02628578204',
			"type": "individual",
			"document_type": "CPF",
			"gender": "male",
			"address": {
				"line_1": `Rua Afro Sampaio, 51. Belo Horizonte`,
				"zip_code": "68502120",
				"city": "Marabá",
				"state": "PA",
				"country": "BR"
			},
			// "birthdate": customerData?.nascimento,
			"phones": {
				"mobile_phone": {
					"country_code": "55",
					//...splitNumberFone(customerData?.fone)
					"area_code": "94",
					"number": "991006004"
				}
			},
			"metadata": {
				//"userId": customerData?.id,
			}
		}
		return customer
	}

	function paymentPix() {

		let payment =
			[
				{
					"payment_method": "pix",
					"pix": {
						"expires_at": '2022-04-10T00:00:00',
						"additional_information": [
							{
								"name": "SALDÃO DE ANIVERSÁRIO",
								"value": " ACIM"
							}
						]
					}
				}
			];

		return payment;
	}

	function enviar_resposta() {

		finalizar_pesquisa();

		setTimeout(() => {


			var url_string = window.location;
			var url = new URL(url_string);

			var vendedor = url.searchParams.get("vendedor");

			$('#perguntas').html('');

			var nome = $('#nome').val();
			var telefone = $('#telefone').val();
			var empresa = $('#empresa').val();
			var cnpj = $('#cnpj').val();
			var associado = $('#associado').val();
			var kits = $('#kits').val();
			var camisaPP = $('#camisaPP').val();
			var camisaP = $('#camisaP').val();
			var camisaM = $('#camisaM').val();
			var camisaG = $('#camisaG').val();
			var camisaGG = $('#camisaGG').val();

			var campanha = 'Saldão de aniversário';

			var valorTotal = returnValorTotal();


			$.ajax({
				url: 'Control/salvarCampanha.php',
				dataType: 'json',
				destroy: true,
				data: {
					campanha,
					vendedor,
					valorTotal,
					'nome': nome,
					'telefone': telefone,
					'empresa': empresa,
					'cnpj': cnpj,
					'associado': associado,
					'kits': kits,
					'camisaPP': camisaPP,
					'camisaP': camisaP,
					'camisaM': camisaM,
					'camisaG': camisaG,
					'camisaGG': camisaGG
				},
				success: function (data) {
					console.log(data);
					if (data) {
						var idCompra = data.id;
						enviarPagarMe(idCompra);
					}

				}
			});

		}, 1000);
	}

	function enviarPagarMe(idCompra) {

		var valorTotal = returnValorTotal();
		var items = returnItems(valorTotal);
		var customer = returnCustomer();
		var payments = paymentPix();

		const metadata = {
			'evento': 'ACIM',
			'idCompra': idCompra,

		}

		let body = {
			items,
			customer,
			payments,
			metadata
		}

		$.ajax({
			url: 'https://api-eventozz-prod.herokuapp.com/simple-payment/',
			dataType: 'json',
			contentType: "application/json",
			type: 'POST',
			type: 'POST',
			destroy: true,
			headers: {
				"Content-Type": "application/json"
			},
			data: JSON.stringify({
				body
			}),
			success: function (data) {

				if (data.status == 200 || data.status == '200') {
					console.log(data);
					var charges = data.data.charge;
					var idTransacao = charges.id;
					var qr_code = charges.qr_code;
					var qr_code_url = charges.qr_code_url;
					var status = charges.status;
					$('#qrCodeGif').attr('src', qr_code_url);
					$('#qrCodeGif').attr('style', 'width:250px !important');
					$('#textoQrCode').html(
						`
						<h4 style='color: #2c2d48' onclick="copiarCodigo('${qr_code}')">Clique aqui para copiar o seu código para pagar via PIX Copia e Cola: </br> </br> 
							</h4>
							
							<p style='font-size:9px' onclick="copiarCodigo('${qr_code}')">${qr_code}</p>
							</br>
							<h4 style='color: #2c2d48' >Após efetuar o pagamento, você irá receber a sua confirmação no seu celular!
							</h4></br>
							`);

					atualizarCompra(idTransacao, qr_code, qr_code_url, idCompra, status);
				}
			}
		});
	}

	function atualizarCompra(idTransacao, qr_code, qr_code_url, idCompra, status) {

		$.ajax({
			url: 'Control/atualizarCompra.php',
			dataType: 'json',
			destroy: true,
			data: {
				idTransacao, qr_code, qr_code_url, idCompra, status
			},
			success: function (data) {
			}
		});

	}

	function copiarCodigo(codigo) {
		var link = codigo;
		var temp = $("<input>");
		$("body").append(temp);
		temp.val(link).select();
		document.execCommand("copy");
		temp.remove();

		Swal.fire('Código copiado!', 'Entre em seu banco, e no PIX Copia e Cole, adicione o código', 'success');
	}

	function finalizar_pesquisa() {
		$('#parte_1').hide(1000);
		$('#parte_2').show(2000);
	}

	function mensagem_agradecendo() {
		let timerInterval
		Swal.fire({
			title: 'Obrigado!',
			icon: 'success',
			html: 'Você é parte de quem somos',
			timer: 4000,
			timerProgressBar: true,
			willClose: () => {
				clearInterval(timerInterval)
			}
		}).then((result) => {

			if (result.dismiss === Swal.DismissReason.timer) {
				console.log('I was closed by the timer')
			}
		})
	}
</script>